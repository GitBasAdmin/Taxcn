// tslint:disable:no-input-rename
import { Directive, EventEmitter, Inject, Input, Output } from "@angular/core";
import { NgxPopperjsContentComponent } from "../../components/ngx-popperjs-content/ngx-popperjs-content.component";
import { NgxPopperjsPlacements } from "../../models/ngx-popperjs-placements.model";
import { NgxPopperjsTriggers } from "../../models/ngx-popperjs-triggers.model";
import { NGX_POPPERJS_DEFAULTS } from "../../models/ngx-popperjs-defaults.model";
import { NgxPopperjsUtils } from "../../models/ngx-popperjs-utils.class";
//
import { fromEvent, Subject, takeUntil, timer } from "rxjs";
import * as i0 from "@angular/core";
class NgxPopperjsDirective {
    _changeDetectorRef;
    _elementRef;
    _vcr;
    _popperDefaults;
    static baseOptions = {
        showDelay: 0,
        placement: NgxPopperjsPlacements.AUTO,
        hideOnClickOutside: true,
        hideOnMouseLeave: false,
        hideOnScroll: false,
        appendTo: undefined,
        ariaRole: "popper",
        ariaDescribe: "",
        styles: {},
        trigger: NgxPopperjsTriggers.click
    };
    set applyClass(newValue) {
        if (newValue === this._applyClass) {
            return;
        }
        this._applyClass = newValue;
        this._checkExisting("applyClass", newValue);
    }
    get applyClass() {
        return this._applyClass;
    }
    ariaDescribe;
    ariaRole;
    boundariesElement;
    closeOnClickOutside;
    set content(newValue) {
        if (newValue === this._content) {
            return;
        }
        this._content = newValue;
        if (this._popperContent) {
            if (typeof newValue === "string") {
                this._popperContent.text = newValue;
            }
            else {
                this._popperContent = newValue;
            }
        }
    }
    get content() {
        return this._content;
    }
    disableAnimation;
    set disabled(newValue) {
        if (newValue === this._disabled) {
            return;
        }
        this._disabled = !!newValue;
        if (this._shown) {
            this.hide();
        }
    }
    get disabled() {
        return this._disabled;
    }
    disableStyle;
    hideOnClickOutside;
    hideOnMouseLeave;
    hideOnScroll;
    hideTimeout = 0;
    set placement(newValue) {
        this._popperPlacement = newValue;
        this._checkExisting("placement", newValue);
    }
    get placement() {
        return this._popperPlacement;
    }
    popperAppendTo;
    set popperApplyArrowClass(newValue) {
        if (newValue === this._popperApplyArrowClass) {
            return;
        }
        this._popperApplyArrowClass = newValue;
        if (this._popperContent) {
            this._popperContent.popperOptions.applyArrowClass = newValue;
            if (!this._shown) {
                return;
            }
            this._popperContent.popperInstance.setOptions(this._popperContent.popperOptions);
        }
    }
    get popperApplyArrowClass() {
        return this._popperApplyArrowClass;
    }
    popperModifiers;
    popperOnHidden = new EventEmitter();
    popperOnShown = new EventEmitter();
    popperOnUpdate = new EventEmitter();
    positionFixed;
    set preventOverflow(newValue) {
        this._popperPreventOverflow = NgxPopperjsUtils.coerceBooleanProperty(newValue);
        this._checkExisting("preventOverflow", this._popperPreventOverflow);
    }
    get preventOverflow() {
        return this._popperPreventOverflow;
    }
    showDelay;
    showOnStart;
    showTrigger;
    styles;
    targetElement;
    timeoutAfterShow = 0;
    _applyClass;
    _content;
    _destroy$ = new Subject();
    _disabled;
    _globalEventListenersCtrl$ = new Subject();
    _popperApplyArrowClass;
    _popperContent;
    _popperContentClass = NgxPopperjsContentComponent;
    _popperContentRef;
    _popperPlacement;
    _popperPreventOverflow;
    _scheduledHideTimeoutCtrl$ = new Subject();
    _scheduledShowTimeoutCtrl$ = new Subject();
    _shown = false;
    constructor(_changeDetectorRef, _elementRef, _vcr, _popperDefaults = {}) {
        this._changeDetectorRef = _changeDetectorRef;
        this._elementRef = _elementRef;
        this._vcr = _vcr;
        this._popperDefaults = _popperDefaults;
        NgxPopperjsDirective.baseOptions = { ...NgxPopperjsDirective.baseOptions, ...this._popperDefaults };
    }
    static assignDefined(target, ...sources) {
        for (const source of sources) {
            for (const key of Object.keys(source)) {
                const val = source[key];
                if (val !== undefined) {
                    target[key] = val;
                }
            }
        }
        return target;
    }
    applyTriggerListeners() {
        switch (this.showTrigger) {
            case NgxPopperjsTriggers.click:
                this._addListener("click", this.toggle.bind(this));
                break;
            case NgxPopperjsTriggers.mousedown:
                this._addListener("mousedown", this.toggle.bind(this));
                break;
            case NgxPopperjsTriggers.hover:
                this._addListener("mouseenter", this.scheduledShow.bind(this, this.showDelay));
                ["touchend", "touchcancel", "mouseleave"].forEach((eventName) => {
                    this._addListener(eventName, this.scheduledHide.bind(this, null, this.hideTimeout));
                });
                break;
        }
        if (this.showTrigger !== NgxPopperjsTriggers.hover && this.hideOnMouseLeave) {
            ["touchend", "touchcancel", "mouseleave"].forEach((eventName) => {
                this._addListener(eventName, this.scheduledHide.bind(this, null, this.hideTimeout));
            });
        }
    }
    getRefElement() {
        return this.targetElement || this._elementRef.nativeElement;
    }
    hide() {
        if (this.disabled) {
            return;
        }
        if (!this._shown) {
            this._scheduledShowTimeoutCtrl$.next();
            return;
        }
        this._shown = false;
        if (this._popperContentRef) {
            this._popperContentRef.instance.hide();
        }
        else {
            this._popperContent.hide();
        }
        this.popperOnHidden.emit(this);
        this._globalEventListenersCtrl$.next();
    }
    hideOnClickOutsideHandler($event) {
        if (this.disabled || !this.hideOnClickOutside || $event.target === this._popperContent.elRef.nativeElement ||
            this._popperContent.elRef.nativeElement.contains($event.target)) {
            return;
        }
        this.scheduledHide($event, this.hideTimeout);
    }
    hideOnScrollHandler($event) {
        if (this.disabled || !this.hideOnScroll) {
            return;
        }
        this.scheduledHide($event, this.hideTimeout);
    }
    ngOnDestroy() {
        this._destroy$.next();
        this._destroy$.complete();
        this._popperContent && this._popperContent.clean();
    }
    ngOnInit() {
        // Support legacy prop
        this.hideOnClickOutside = typeof this.hideOnClickOutside === "undefined" ?
            this.closeOnClickOutside : this.hideOnClickOutside;
        if (typeof this.content === "string") {
            this._popperContent = this._constructContent();
            this._popperContent.text = this.content;
        }
        else if (typeof this.content === typeof void 0) {
            this._popperContent = this._constructContent();
            this._popperContent.text = "";
        }
        else {
            this._popperContent = this.content;
        }
        const popperRef = this._popperContent;
        popperRef.referenceObject = this.getRefElement();
        this._setContentProperties(popperRef);
        this._setDefaults();
        this.applyTriggerListeners();
        if (this.showOnStart) {
            this.scheduledShow();
        }
    }
    scheduledHide($event = null, delay = this.hideTimeout) {
        if (this.disabled) {
            return;
        }
        this._scheduledShowTimeoutCtrl$.next();
        timer(delay)
            .pipe(takeUntil(this._scheduledHideTimeoutCtrl$), takeUntil(this._destroy$))
            .subscribe({
            next: () => {
                // TODO: check
                const toElement = $event ? $event.toElement : null;
                const popperContentView = this._popperContent.popperViewRef ? this._popperContent.popperViewRef.nativeElement : false;
                if (!popperContentView ||
                    popperContentView === toElement ||
                    popperContentView.contains(toElement) ||
                    (this.content && this.content.isMouseOver)) {
                    return;
                }
                this.hide();
                this._applyChanges();
            }
        });
    }
    scheduledShow(delay = this.showDelay) {
        if (this.disabled) {
            return;
        }
        this._scheduledHideTimeoutCtrl$.next();
        timer(delay)
            .pipe(takeUntil(this._scheduledShowTimeoutCtrl$), takeUntil(this._destroy$))
            .subscribe({
            next: () => {
                this.show();
                this._applyChanges();
            }
        });
    }
    show() {
        if (this._shown) {
            this._scheduledHideTimeoutCtrl$.next();
            return;
        }
        this._shown = true;
        const popperRef = this._popperContent;
        const element = this.getRefElement();
        if (popperRef.referenceObject !== element) {
            popperRef.referenceObject = element;
        }
        this._setContentProperties(popperRef);
        popperRef.show();
        this.popperOnShown.emit(this);
        if (this.timeoutAfterShow > 0) {
            this.scheduledHide(null, this.timeoutAfterShow);
        }
        fromEvent(document, "click")
            .pipe(takeUntil(this._globalEventListenersCtrl$), takeUntil(this._destroy$))
            .subscribe({
            next: (e) => this.hideOnClickOutsideHandler(e)
        });
        fromEvent(this._getScrollParent(this.getRefElement()), "scroll")
            .pipe(takeUntil(this._globalEventListenersCtrl$), takeUntil(this._destroy$))
            .subscribe({
            next: (e) => {
                this.hideOnScrollHandler(e);
            }
        });
    }
    toggle() {
        if (this.disabled) {
            return;
        }
        this._shown ? this.scheduledHide(null, this.hideTimeout) : this.scheduledShow();
    }
    _addListener(eventName, cb) {
        fromEvent(this._elementRef.nativeElement, eventName)
            .pipe(takeUntil(this._destroy$))
            .subscribe({
            next: cb
        });
    }
    _applyChanges() {
        this._changeDetectorRef.markForCheck();
        this._changeDetectorRef.detectChanges();
    }
    _checkExisting(key, newValue) {
        if (this._popperContent) {
            this._popperContent.popperOptions[key] = newValue;
            if (!this._shown) {
                return;
            }
            this._popperContent.popperInstance.setOptions(this._popperContent.popperOptions);
        }
    }
    _constructContent() {
        this._popperContentRef = this._vcr.createComponent(this._popperContentClass);
        return this._popperContentRef.instance;
    }
    _getScrollParent(node) {
        const isElement = node instanceof HTMLElement;
        const overflowY = isElement && window.getComputedStyle(node).overflowY;
        const isScrollable = overflowY !== "visible" && overflowY !== "hidden";
        if (!node) {
            return null;
        }
        else if (isScrollable && node.scrollHeight > node.clientHeight) {
            return node;
        }
        return this._getScrollParent(node.parentNode) || document;
    }
    _onPopperUpdate(event) {
        this.popperOnUpdate.emit(event);
    }
    _setContentProperties(popperRef) {
        popperRef.popperOptions = NgxPopperjsDirective.assignDefined(popperRef.popperOptions, NgxPopperjsDirective.baseOptions, {
            showDelay: this.showDelay,
            disableAnimation: this.disableAnimation,
            disableDefaultStyling: this.disableStyle,
            placement: this.placement,
            boundariesElement: this.boundariesElement,
            trigger: this.showTrigger,
            positionFixed: this.positionFixed,
            popperModifiers: this.popperModifiers,
            ariaDescribe: this.ariaDescribe,
            ariaRole: this.ariaRole,
            applyClass: this.applyClass,
            applyArrowClass: this.popperApplyArrowClass,
            hideOnMouseLeave: this.hideOnMouseLeave,
            styles: this.styles,
            appendTo: this.popperAppendTo,
            preventOverflow: this.preventOverflow,
        });
        popperRef.onUpdate = this._onPopperUpdate.bind(this);
        popperRef.onHidden
            .pipe(takeUntil(this._destroy$))
            .subscribe(this.hide.bind(this));
    }
    _setDefaults() {
        ["showDelay", "hideOnScroll", "hideOnMouseLeave", "hideOnClickOutside", "ariaRole", "ariaDescribe"].forEach((key) => {
            this[key] = this[key] === void 0 ? NgxPopperjsDirective.baseOptions[key] : this[key];
        });
        this.showTrigger = this.showTrigger || NgxPopperjsDirective.baseOptions.trigger;
        this.styles = this.styles === void 0 ? { ...NgxPopperjsDirective.baseOptions.styles } : this.styles;
    }
    /** @nocollapse */ static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: NgxPopperjsDirective, deps: [{ token: i0.ChangeDetectorRef }, { token: i0.ElementRef }, { token: i0.ViewContainerRef }, { token: NGX_POPPERJS_DEFAULTS }], target: i0.ɵɵFactoryTarget.Directive });
    /** @nocollapse */ static ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.0.2", type: NgxPopperjsDirective, selector: "[popper]", inputs: { applyClass: ["popperApplyClass", "applyClass"], ariaDescribe: ["popperAriaDescribeBy", "ariaDescribe"], ariaRole: ["popperAriaRole", "ariaRole"], boundariesElement: ["popperBoundaries", "boundariesElement"], closeOnClickOutside: ["popperCloseOnClickOutside", "closeOnClickOutside"], content: ["popper", "content"], disableAnimation: ["popperDisableAnimation", "disableAnimation"], disabled: ["popperDisabled", "disabled"], disableStyle: ["popperDisableStyle", "disableStyle"], hideOnClickOutside: ["popperHideOnClickOutside", "hideOnClickOutside"], hideOnMouseLeave: ["popperHideOnMouseLeave", "hideOnMouseLeave"], hideOnScroll: ["popperHideOnScroll", "hideOnScroll"], hideTimeout: ["popperTimeout", "hideTimeout"], placement: ["popperPlacement", "placement"], popperAppendTo: "popperAppendTo", popperApplyArrowClass: "popperApplyArrowClass", popperModifiers: "popperModifiers", positionFixed: ["popperPositionFixed", "positionFixed"], preventOverflow: ["popperPreventOverflow", "preventOverflow"], showDelay: ["popperDelay", "showDelay"], showOnStart: ["popperShowOnStart", "showOnStart"], showTrigger: ["popperTrigger", "showTrigger"], styles: ["popperStyles", "styles"], targetElement: ["popperTarget", "targetElement"], timeoutAfterShow: ["popperTimeoutAfterShow", "timeoutAfterShow"] }, outputs: { popperOnHidden: "popperOnHidden", popperOnShown: "popperOnShown", popperOnUpdate: "popperOnUpdate" }, exportAs: ["popper"], ngImport: i0 });
}
export { NgxPopperjsDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: NgxPopperjsDirective, decorators: [{
            type: Directive,
            args: [{
                    // tslint:disable-next-line:directive-selector
                    selector: "[popper]",
                    exportAs: "popper"
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: i0.ViewContainerRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [NGX_POPPERJS_DEFAULTS]
                }] }]; }, propDecorators: { applyClass: [{
                type: Input,
                args: ["popperApplyClass"]
            }], ariaDescribe: [{
                type: Input,
                args: ["popperAriaDescribeBy"]
            }], ariaRole: [{
                type: Input,
                args: ["popperAriaRole"]
            }], boundariesElement: [{
                type: Input,
                args: ["popperBoundaries"]
            }], closeOnClickOutside: [{
                type: Input,
                args: ["popperCloseOnClickOutside"]
            }], content: [{
                type: Input,
                args: ["popper"]
            }], disableAnimation: [{
                type: Input,
                args: ["popperDisableAnimation"]
            }], disabled: [{
                type: Input,
                args: ["popperDisabled"]
            }], disableStyle: [{
                type: Input,
                args: ["popperDisableStyle"]
            }], hideOnClickOutside: [{
                type: Input,
                args: ["popperHideOnClickOutside"]
            }], hideOnMouseLeave: [{
                type: Input,
                args: ["popperHideOnMouseLeave"]
            }], hideOnScroll: [{
                type: Input,
                args: ["popperHideOnScroll"]
            }], hideTimeout: [{
                type: Input,
                args: ["popperTimeout"]
            }], placement: [{
                type: Input,
                args: ["popperPlacement"]
            }], popperAppendTo: [{
                type: Input
            }], popperApplyArrowClass: [{
                type: Input
            }], popperModifiers: [{
                type: Input
            }], popperOnHidden: [{
                type: Output
            }], popperOnShown: [{
                type: Output
            }], popperOnUpdate: [{
                type: Output
            }], positionFixed: [{
                type: Input,
                args: ["popperPositionFixed"]
            }], preventOverflow: [{
                type: Input,
                args: ["popperPreventOverflow"]
            }], showDelay: [{
                type: Input,
                args: ["popperDelay"]
            }], showOnStart: [{
                type: Input,
                args: ["popperShowOnStart"]
            }], showTrigger: [{
                type: Input,
                args: ["popperTrigger"]
            }], styles: [{
                type: Input,
                args: ["popperStyles"]
            }], targetElement: [{
                type: Input,
                args: ["popperTarget"]
            }], timeoutAfterShow: [{
                type: Input,
                args: ["popperTimeoutAfterShow"]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBvcHBlcmpzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1wb3BwZXJqcy9zcmMvbGliL2RpcmVjdGl2ZXMvbmd4LXBvcHBlcmpzL25neC1wb3BwZXJqcy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaUNBQWlDO0FBQ2pDLE9BQU8sRUFHSCxTQUFTLEVBRVQsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBR0wsTUFBTSxFQUVULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQywyQkFBMkIsRUFBQyxNQUFNLHNFQUFzRSxDQUFDO0FBRWpILE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLDRDQUE0QyxDQUFDO0FBQ2pGLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLDBDQUEwQyxDQUFDO0FBQzdFLE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLDBDQUEwQyxDQUFDO0FBQy9FLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLHVDQUF1QyxDQUFDO0FBR3ZFLEVBQUU7QUFDRixPQUFPLEVBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFDLE1BQU0sTUFBTSxDQUFDOztBQUUxRCxNQUthLG9CQUFvQjtJQTBMUDtJQUNBO0lBQ0E7SUFDK0I7SUEzTHJELE1BQU0sQ0FBQyxXQUFXLEdBQXVCO1FBQ3JDLFNBQVMsRUFBRSxDQUFDO1FBQ1osU0FBUyxFQUFFLHFCQUFxQixDQUFDLElBQUk7UUFDckMsa0JBQWtCLEVBQUUsSUFBSTtRQUN4QixnQkFBZ0IsRUFBRSxLQUFLO1FBQ3ZCLFlBQVksRUFBRSxLQUFLO1FBQ25CLFFBQVEsRUFBRSxTQUFTO1FBQ25CLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE1BQU0sRUFBRSxFQUFFO1FBQ1YsT0FBTyxFQUFFLG1CQUFtQixDQUFDLEtB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QkFEWixLQUFLO3VCQUFDLGlCQUFpQjtnQkFZeEIsY0FBYztzQkFEYixLQUFLO2dCQUlGLHFCQUFxQjtzQkFEeEIsS0FBSztnQkFvQk4sZUFBZTtzQkFEZCxLQUFLO2dCQUlOLGNBQWM7c0JBRGIsTUFBTTtnQkFJUCxhQUFhO3NCQURaLE1BQU07Z0JBSVAsY0FBYztzQkFEYixNQUFNO2dCQUlQLGFBQWE7c0JBRFosS0FBSzt1QkFBQyxxQkFBcUI7Z0JBSXhCLGVBQWU7c0JBRGxCLEtBQUs7dUJBQUMsdUJBQXVCO2dCQVc5QixTQUFTO3NCQURSLEtBQUs7dUJBQUMsYUFBYTtnQkFJcEIsV0FBVztzQkFEVixLQUFLO3VCQUFDLG1CQUFtQjtnQkFJMUIsV0FBVztzQkFEVixLQUFLO3VCQUFDLGVBQWU7Z0JBSXRCLE1BQU07c0JBREwsS0FBSzt1QkFBQyxjQUFjO2dCQUlyQixhQUFhO3NCQURaLEtBQUs7dUJBQUMsY0FBYztnQkFJckIsZ0JBQWdCO3NCQURmLEtBQUs7dUJBQUMsd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6bm8taW5wdXQtcmVuYW1lXHJcbmltcG9ydCB7XHJcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIENvbXBvbmVudFJlZixcclxuICAgIERpcmVjdGl2ZSxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBJbmplY3QsXHJcbiAgICBJbnB1dCxcclxuICAgIE9uRGVzdHJveSxcclxuICAgIE9uSW5pdCxcclxuICAgIE91dHB1dCxcclxuICAgIFZpZXdDb250YWluZXJSZWZcclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQge05neFBvcHBlcmpzQ29udGVudENvbXBvbmVudH0gZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvbmd4LXBvcHBlcmpzLWNvbnRlbnQvbmd4LXBvcHBlcmpzLWNvbnRlbnQuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7Tmd4UG9wcGVyanNPcHRpb25zfSBmcm9tIFwiLi4vLi4vbW9kZWxzL25neC1wb3BwZXJqcy1vcHRpb25zLm1vZGVsXCI7XHJcbmltcG9ydCB7Tmd4UG9wcGVyanNQbGFjZW1lbnRzfSBmcm9tIFwiLi4vLi4vbW9kZWxzL25neC1wb3BwZXJqcy1wbGFjZW1lbnRzLm1vZGVsXCI7XHJcbmltcG9ydCB7Tmd4UG9wcGVyanNUcmlnZ2Vyc30gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtcG9wcGVyanMtdHJpZ2dlcnMubW9kZWxcIjtcclxuaW1wb3J0IHtOR1hfUE9QUEVSSlNfREVGQVVMVFN9IGZyb20gXCIuLi8uLi9tb2RlbHMvbmd4LXBvcHBlcmpzLWRlZmF1bHRzLm1vZGVsXCI7XHJcbmltcG9ydCB7Tmd4UG9wcGVyanNVdGlsc30gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtcG9wcGVyanMtdXRpbHMuY2xhc3NcIjtcclxuLy9cclxuaW1wb3J0IHtNb2RpZmllcn0gZnJvbSBcIkBwb3BwZXJqcy9jb3JlXCI7XHJcbi8vXHJcbmltcG9ydCB7ZnJvbUV2ZW50LCBTdWJqZWN0LCB0YWtlVW50aWwsIHRpbWVyfSBmcm9tIFwicnhqc1wiO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXHJcbiAgICBzZWxlY3RvcjogXCJbcG9wcGVyXVwiLFxyXG4gICAgZXhwb3J0QXM6IFwicG9wcGVyXCJcclxufSlcclxuZXhwb3J0IGNsYXNzIE5neFBvcHBlcmpzRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIHN0YXRpYyBiYXNlT3B0aW9uczogTmd4UG9wcGVyanNPcHRpb25zID0ge1xyXG4gICAgICAgIHNob3dEZWxheTogMCxcclxuICAgICAgICBwbGFjZW1lbnQ6IE5neFBvcHBlcmpzUGxhY2VtZW50cy5BVVRPLFxyXG4gICAgICAgIGhpZGVPbkNsaWNrT3V0c2lkZTogdHJ1ZSxcclxuICAgICAgICBoaWRlT25Nb3VzZUxlYXZlOiBmYWxzZSxcclxuICAgICAgICBoaWRlT25TY3JvbGw6IGZhbHNlLFxyXG4gICAgICAgIGFwcGVuZFRvOiB1bmRlZmluZWQsXHJcbiAgICAgICAgYXJpYVJvbGU6IFwicG9wcGVyXCIsXHJcbiAgICAgICAgYXJpYURlc2NyaWJlOiBcIlwiLFxyXG4gICAgICAgIHN0eWxlczoge30sXHJcbiAgICAgICAgdHJpZ2dlcjogTmd4UG9wcGVyanNUcmlnZ2Vycy5jbGlja1xyXG4gICAgfTtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJBcHBseUNsYXNzXCIpXHJcbiAgICBzZXQgYXBwbHlDbGFzcyhuZXdWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB0aGlzLl9hcHBseUNsYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fYXBwbHlDbGFzcyA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2NoZWNrRXhpc3RpbmcoXCJhcHBseUNsYXNzXCIsIG5ld1ZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYXBwbHlDbGFzcygpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hcHBseUNsYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckFyaWFEZXNjcmliZUJ5XCIpXHJcbiAgICBhcmlhRGVzY3JpYmU6IHN0cmluZyB8IHZvaWQ7XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyQXJpYVJvbGVcIilcclxuICAgIGFyaWFSb2xlOiBzdHJpbmcgfCB2b2lkO1xyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckJvdW5kYXJpZXNcIilcclxuICAgIGJvdW5kYXJpZXNFbGVtZW50OiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyQ2xvc2VPbkNsaWNrT3V0c2lkZVwiKVxyXG4gICAgY2xvc2VPbkNsaWNrT3V0c2lkZTogYm9vbGVhbjtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJcIilcclxuICAgIHNldCBjb250ZW50KG5ld1ZhbHVlOiBzdHJpbmcgfCBOZ3hQb3BwZXJqc0NvbnRlbnRDb21wb25lbnQpIHtcclxuICAgICAgICBpZiAobmV3VmFsdWUgPT09IHRoaXMuX2NvbnRlbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fY29udGVudCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLl9wb3BwZXJDb250ZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQudGV4dCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb250ZW50KCk6IHN0cmluZyB8IE5neFBvcHBlcmpzQ29udGVudENvbXBvbmVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckRpc2FibGVBbmltYXRpb25cIilcclxuICAgIGRpc2FibGVBbmltYXRpb246IGJvb2xlYW47XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyRGlzYWJsZWRcIilcclxuICAgIHNldCBkaXNhYmxlZChuZXdWYWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9kaXNhYmxlZCA9ICEhbmV3VmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Nob3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckRpc2FibGVTdHlsZVwiKVxyXG4gICAgZGlzYWJsZVN0eWxlOiBib29sZWFuO1xyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckhpZGVPbkNsaWNrT3V0c2lkZVwiKVxyXG4gICAgaGlkZU9uQ2xpY2tPdXRzaWRlOiBib29sZWFuIHwgdm9pZDtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJIaWRlT25Nb3VzZUxlYXZlXCIpXHJcbiAgICBoaWRlT25Nb3VzZUxlYXZlOiBib29sZWFuIHwgdm9pZDtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJIaWRlT25TY3JvbGxcIilcclxuICAgIGhpZGVPblNjcm9sbDogYm9vbGVhbiB8IHZvaWQ7XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyVGltZW91dFwiKVxyXG4gICAgaGlkZVRpbWVvdXQ6IG51bWJlciA9IDA7XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyUGxhY2VtZW50XCIpXHJcbiAgICBzZXQgcGxhY2VtZW50KG5ld1ZhbHVlOiBOZ3hQb3BwZXJqc1BsYWNlbWVudHMpIHtcclxuICAgICAgICB0aGlzLl9wb3BwZXJQbGFjZW1lbnQgPSBuZXdWYWx1ZTtcclxuICAgICAgICB0aGlzLl9jaGVja0V4aXN0aW5nKFwicGxhY2VtZW50XCIsIG5ld1ZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcGxhY2VtZW50KCk6IE5neFBvcHBlcmpzUGxhY2VtZW50cyB7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3BwZXJQbGFjZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHBvcHBlckFwcGVuZFRvOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBwb3BwZXJBcHBseUFycm93Q2xhc3MobmV3VmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdGhpcy5fcG9wcGVyQXBwbHlBcnJvd0NsYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcG9wcGVyQXBwbHlBcnJvd0NsYXNzID0gbmV3VmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BvcHBlckNvbnRlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudC5wb3BwZXJPcHRpb25zLmFwcGx5QXJyb3dDbGFzcyA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3Nob3duKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudC5wb3BwZXJJbnN0YW5jZS5zZXRPcHRpb25zKHRoaXMuX3BvcHBlckNvbnRlbnQucG9wcGVyT3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBwb3BwZXJBcHBseUFycm93Q2xhc3MoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9wcGVyQXBwbHlBcnJvd0NsYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBwb3BwZXJNb2RpZmllcnM6IFBhcnRpYWw8TW9kaWZpZXI8YW55LCBhbnk+PltdO1xyXG5cclxuICAgIEBPdXRwdXQoKVxyXG4gICAgcG9wcGVyT25IaWRkZW46IEV2ZW50RW1pdHRlcjxOZ3hQb3BwZXJqc0RpcmVjdGl2ZT4gPSBuZXcgRXZlbnRFbWl0dGVyPE5neFBvcHBlcmpzRGlyZWN0aXZlPigpO1xyXG5cclxuICAgIEBPdXRwdXQoKVxyXG4gICAgcG9wcGVyT25TaG93bjogRXZlbnRFbWl0dGVyPE5neFBvcHBlcmpzRGlyZWN0aXZlPiA9IG5ldyBFdmVudEVtaXR0ZXI8Tmd4UG9wcGVyanNEaXJlY3RpdmU+KCk7XHJcblxyXG4gICAgQE91dHB1dCgpXHJcbiAgICBwb3BwZXJPblVwZGF0ZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJQb3NpdGlvbkZpeGVkXCIpXHJcbiAgICBwb3NpdGlvbkZpeGVkOiBib29sZWFuO1xyXG5cclxuICAgIEBJbnB1dChcInBvcHBlclByZXZlbnRPdmVyZmxvd1wiKVxyXG4gICAgc2V0IHByZXZlbnRPdmVyZmxvdyhuZXdWYWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3BvcHBlclByZXZlbnRPdmVyZmxvdyA9IE5neFBvcHBlcmpzVXRpbHMuY29lcmNlQm9vbGVhblByb3BlcnR5KG5ld1ZhbHVlKTtcclxuICAgICAgICB0aGlzLl9jaGVja0V4aXN0aW5nKFwicHJldmVudE92ZXJmbG93XCIsIHRoaXMuX3BvcHBlclByZXZlbnRPdmVyZmxvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHByZXZlbnRPdmVyZmxvdygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9wcGVyUHJldmVudE92ZXJmbG93O1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dChcInBvcHBlckRlbGF5XCIpXHJcbiAgICBzaG93RGVsYXk6IG51bWJlciB8IHVuZGVmaW5lZDtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJTaG93T25TdGFydFwiKVxyXG4gICAgc2hvd09uU3RhcnQ6IGJvb2xlYW47XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyVHJpZ2dlclwiKVxyXG4gICAgc2hvd1RyaWdnZXI6IE5neFBvcHBlcmpzVHJpZ2dlcnMgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgQElucHV0KFwicG9wcGVyU3R5bGVzXCIpXHJcbiAgICBzdHlsZXM6IG9iamVjdDtcclxuXHJcbiAgICBASW5wdXQoXCJwb3BwZXJUYXJnZXRcIilcclxuICAgIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG5cclxuICAgIEBJbnB1dChcInBvcHBlclRpbWVvdXRBZnRlclNob3dcIilcclxuICAgIHRpbWVvdXRBZnRlclNob3c6IG51bWJlciA9IDA7XHJcblxyXG4gICAgcHJvdGVjdGVkIF9hcHBseUNsYXNzOiBzdHJpbmc7XHJcbiAgICBwcm90ZWN0ZWQgX2NvbnRlbnQ6IHN0cmluZyB8IE5neFBvcHBlcmpzQ29udGVudENvbXBvbmVudDtcclxuICAgIHByb3RlY3RlZCBfZGVzdHJveSQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gICAgcHJvdGVjdGVkIF9kaXNhYmxlZDogYm9vbGVhbjtcclxuICAgIHByb3RlY3RlZCBfZ2xvYmFsRXZlbnRMaXN0ZW5lcnNDdHJsJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgICBwcm90ZWN0ZWQgX3BvcHBlckFwcGx5QXJyb3dDbGFzczogc3RyaW5nO1xyXG4gICAgcHJvdGVjdGVkIF9wb3BwZXJDb250ZW50OiBOZ3hQb3BwZXJqc0NvbnRlbnRDb21wb25lbnQ7XHJcbiAgICBwcm90ZWN0ZWQgX3BvcHBlckNvbnRlbnRDbGFzcyA9IE5neFBvcHBlcmpzQ29udGVudENvbXBvbmVudDtcclxuICAgIHByb3RlY3RlZCBfcG9wcGVyQ29udGVudFJlZjogQ29tcG9uZW50UmVmPE5neFBvcHBlcmpzQ29udGVudENvbXBvbmVudD47XHJcbiAgICBwcm90ZWN0ZWQgX3BvcHBlclBsYWNlbWVudDogTmd4UG9wcGVyanNQbGFjZW1lbnRzO1xyXG4gICAgcHJvdGVjdGVkIF9wb3BwZXJQcmV2ZW50T3ZlcmZsb3c6IGJvb2xlYW47XHJcbiAgICBwcm90ZWN0ZWQgX3NjaGVkdWxlZEhpZGVUaW1lb3V0Q3RybCQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gICAgcHJvdGVjdGVkIF9zY2hlZHVsZWRTaG93VGltZW91dEN0cmwkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICAgIHByb3RlY3RlZCBfc2hvd246IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgX2NoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBfZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBfdmNyOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgICAgICAgICAgICAgQEluamVjdChOR1hfUE9QUEVSSlNfREVGQVVMVFMpIHByb3RlY3RlZCBfcG9wcGVyRGVmYXVsdHM6IE5neFBvcHBlcmpzT3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgTmd4UG9wcGVyanNEaXJlY3RpdmUuYmFzZU9wdGlvbnMgPSB7Li4uTmd4UG9wcGVyanNEaXJlY3RpdmUuYmFzZU9wdGlvbnMsIC4uLnRoaXMuX3BvcHBlckRlZmF1bHRzfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXNzaWduRGVmaW5lZCh0YXJnZXQ6IGFueSwgLi4uc291cmNlczogYW55W10pIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHNvdXJjZSBvZiBzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHNvdXJjZSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHNvdXJjZVtrZXldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgYXBwbHlUcmlnZ2VyTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zaG93VHJpZ2dlcikge1xyXG4gICAgICAgICAgICBjYXNlIE5neFBvcHBlcmpzVHJpZ2dlcnMuY2xpY2s6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMudG9nZ2xlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTmd4UG9wcGVyanNUcmlnZ2Vycy5tb3VzZWRvd246XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIE5neFBvcHBlcmpzVHJpZ2dlcnMuaG92ZXI6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgdGhpcy5zY2hlZHVsZWRTaG93LmJpbmQodGhpcywgdGhpcy5zaG93RGVsYXkpKTtcclxuICAgICAgICAgICAgICAgIFtcInRvdWNoZW5kXCIsIFwidG91Y2hjYW5jZWxcIiwgXCJtb3VzZWxlYXZlXCJdLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZExpc3RlbmVyKGV2ZW50TmFtZSwgdGhpcy5zY2hlZHVsZWRIaWRlLmJpbmQodGhpcywgbnVsbCwgdGhpcy5oaWRlVGltZW91dCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RyaWdnZXIgIT09IE5neFBvcHBlcmpzVHJpZ2dlcnMuaG92ZXIgJiYgdGhpcy5oaWRlT25Nb3VzZUxlYXZlKSB7XHJcbiAgICAgICAgICAgIFtcInRvdWNoZW5kXCIsIFwidG91Y2hjYW5jZWxcIiwgXCJtb3VzZWxlYXZlXCJdLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkTGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLnNjaGVkdWxlZEhpZGUuYmluZCh0aGlzLCBudWxsLCB0aGlzLmhpZGVUaW1lb3V0KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRSZWZFbGVtZW50KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRhcmdldEVsZW1lbnQgfHwgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuX3Nob3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NjaGVkdWxlZFNob3dUaW1lb3V0Q3RybCQubmV4dCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc2hvd24gPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5fcG9wcGVyQ29udGVudFJlZikge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3BwZXJDb250ZW50UmVmLmluc3RhbmNlLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBvcHBlck9uSGlkZGVuLmVtaXQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5fZ2xvYmFsRXZlbnRMaXN0ZW5lcnNDdHJsJC5uZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZU9uQ2xpY2tPdXRzaWRlSGFuZGxlcigkZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCB8fCAhdGhpcy5oaWRlT25DbGlja091dHNpZGUgfHwgJGV2ZW50LnRhcmdldCA9PT0gdGhpcy5fcG9wcGVyQ29udGVudC5lbFJlZi5uYXRpdmVFbGVtZW50IHx8XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQuZWxSZWYubmF0aXZlRWxlbWVudC5jb250YWlucygkZXZlbnQudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVkSGlkZSgkZXZlbnQsIHRoaXMuaGlkZVRpbWVvdXQpO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVPblNjcm9sbEhhbmRsZXIoJGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQgfHwgIXRoaXMuaGlkZU9uU2Nyb2xsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZWRIaWRlKCRldmVudCwgdGhpcy5oaWRlVGltZW91dCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5fZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuX2Rlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudCAmJiB0aGlzLl9wb3BwZXJDb250ZW50LmNsZWFuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgLy8gU3VwcG9ydCBsZWdhY3kgcHJvcFxyXG4gICAgICAgIHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlID0gdHlwZW9mIHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlID09PSBcInVuZGVmaW5lZFwiID9cclxuICAgICAgICAgICAgdGhpcy5jbG9zZU9uQ2xpY2tPdXRzaWRlIDogdGhpcy5oaWRlT25DbGlja091dHNpZGU7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5jb250ZW50ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQgPSB0aGlzLl9jb25zdHJ1Y3RDb250ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQudGV4dCA9IHRoaXMuY29udGVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRoaXMuY29udGVudCA9PT0gdHlwZW9mIHZvaWQgMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3BwZXJDb250ZW50ID0gdGhpcy5fY29uc3RydWN0Q29udGVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9wb3BwZXJDb250ZW50LnRleHQgPSBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudCA9IHRoaXMuY29udGVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcG9wcGVyUmVmID0gdGhpcy5fcG9wcGVyQ29udGVudDtcclxuICAgICAgICBwb3BwZXJSZWYucmVmZXJlbmNlT2JqZWN0ID0gdGhpcy5nZXRSZWZFbGVtZW50KCk7XHJcbiAgICAgICAgdGhpcy5fc2V0Q29udGVudFByb3BlcnRpZXMocG9wcGVyUmVmKTtcclxuICAgICAgICB0aGlzLl9zZXREZWZhdWx0cygpO1xyXG4gICAgICAgIHRoaXMuYXBwbHlUcmlnZ2VyTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd09uU3RhcnQpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWRTaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNjaGVkdWxlZEhpZGUoJGV2ZW50OiBhbnkgPSBudWxsLCBkZWxheTogbnVtYmVyID0gdGhpcy5oaWRlVGltZW91dCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc2NoZWR1bGVkU2hvd1RpbWVvdXRDdHJsJC5uZXh0KCk7XHJcbiAgICAgICAgdGltZXIoZGVsYXkpXHJcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9zY2hlZHVsZWRIaWRlVGltZW91dEN0cmwkKSwgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZSh7XHJcbiAgICAgICAgICAgICAgICBuZXh0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogY2hlY2tcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0b0VsZW1lbnQgPSAkZXZlbnQgPyAkZXZlbnQudG9FbGVtZW50IDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3BwZXJDb250ZW50VmlldyA9IHRoaXMuX3BvcHBlckNvbnRlbnQucG9wcGVyVmlld1JlZiA/IHRoaXMuX3BvcHBlckNvbnRlbnQucG9wcGVyVmlld1JlZi5uYXRpdmVFbGVtZW50IDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwb3BwZXJDb250ZW50VmlldyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3BwZXJDb250ZW50VmlldyA9PT0gdG9FbGVtZW50IHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHBlckNvbnRlbnRWaWV3LmNvbnRhaW5zKHRvRWxlbWVudCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuY29udGVudCAmJiAodGhpcy5jb250ZW50IGFzIE5neFBvcHBlcmpzQ29udGVudENvbXBvbmVudCkuaXNNb3VzZU92ZXIpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzY2hlZHVsZWRTaG93KGRlbGF5OiBudW1iZXIgPSB0aGlzLnNob3dEZWxheSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc2NoZWR1bGVkSGlkZVRpbWVvdXRDdHJsJC5uZXh0KCk7XHJcbiAgICAgICAgdGltZXIoZGVsYXkpXHJcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9zY2hlZHVsZWRTaG93VGltZW91dEN0cmwkKSwgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZSh7XHJcbiAgICAgICAgICAgICAgICBuZXh0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Nob3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NjaGVkdWxlZEhpZGVUaW1lb3V0Q3RybCQubmV4dCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc2hvd24gPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IHBvcHBlclJlZiA9IHRoaXMuX3BvcHBlckNvbnRlbnQ7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZ2V0UmVmRWxlbWVudCgpO1xyXG4gICAgICAgIGlmIChwb3BwZXJSZWYucmVmZXJlbmNlT2JqZWN0ICE9PSBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHBvcHBlclJlZi5yZWZlcmVuY2VPYmplY3QgPSBlbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9zZXRDb250ZW50UHJvcGVydGllcyhwb3BwZXJSZWYpO1xyXG4gICAgICAgIHBvcHBlclJlZi5zaG93KCk7XHJcbiAgICAgICAgdGhpcy5wb3BwZXJPblNob3duLmVtaXQodGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZW91dEFmdGVyU2hvdyA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWRIaWRlKG51bGwsIHRoaXMudGltZW91dEFmdGVyU2hvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZyb21FdmVudChkb2N1bWVudCwgXCJjbGlja1wiKVxyXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZ2xvYmFsRXZlbnRMaXN0ZW5lcnNDdHJsJCksIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoe1xyXG4gICAgICAgICAgICAgICAgbmV4dDogKGU6IE1vdXNlRXZlbnQpID0+IHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlSGFuZGxlcihlKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICBmcm9tRXZlbnQodGhpcy5fZ2V0U2Nyb2xsUGFyZW50KHRoaXMuZ2V0UmVmRWxlbWVudCgpKSwgXCJzY3JvbGxcIilcclxuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuX2dsb2JhbEV2ZW50TGlzdGVuZXJzQ3RybCQpLCB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHtcclxuICAgICAgICAgICAgICAgIG5leHQ6IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlT25TY3JvbGxIYW5kbGVyKGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9zaG93biA/IHRoaXMuc2NoZWR1bGVkSGlkZShudWxsLCB0aGlzLmhpZGVUaW1lb3V0KSA6IHRoaXMuc2NoZWR1bGVkU2hvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfYWRkTGlzdGVuZXIoZXZlbnROYW1lOiBzdHJpbmcsIGNiOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgZnJvbUV2ZW50KHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgZXZlbnROYW1lKVxyXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHtcclxuICAgICAgICAgICAgICAgIG5leHQ6IGNiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfYXBwbHlDaGFuZ2VzKCkge1xyXG4gICAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2NoZWNrRXhpc3Rpbmcoa2V5OiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgTmd4UG9wcGVyanNQbGFjZW1lbnRzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BvcHBlckNvbnRlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wcGVyQ29udGVudC5wb3BwZXJPcHRpb25zW2tleV0gPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9zaG93bikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHBlckNvbnRlbnQucG9wcGVySW5zdGFuY2Uuc2V0T3B0aW9ucyh0aGlzLl9wb3BwZXJDb250ZW50LnBvcHBlck9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2NvbnN0cnVjdENvbnRlbnQoKTogTmd4UG9wcGVyanNDb250ZW50Q29tcG9uZW50IHtcclxuICAgICAgICB0aGlzLl9wb3BwZXJDb250ZW50UmVmID0gdGhpcy5fdmNyLmNyZWF0ZUNvbXBvbmVudCh0aGlzLl9wb3BwZXJDb250ZW50Q2xhc3MpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9wcGVyQ29udGVudFJlZi5pbnN0YW5jZSBhcyBOZ3hQb3BwZXJqc0NvbnRlbnRDb21wb25lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9nZXRTY3JvbGxQYXJlbnQobm9kZSkge1xyXG4gICAgICAgIGNvbnN0IGlzRWxlbWVudCA9IG5vZGUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudDtcclxuICAgICAgICBjb25zdCBvdmVyZmxvd1kgPSBpc0VsZW1lbnQgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUobm9kZSkub3ZlcmZsb3dZO1xyXG4gICAgICAgIGNvbnN0IGlzU2Nyb2xsYWJsZSA9IG92ZXJmbG93WSAhPT0gXCJ2aXNpYmxlXCIgJiYgb3ZlcmZsb3dZICE9PSBcImhpZGRlblwiO1xyXG5cclxuICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGlzU2Nyb2xsYWJsZSAmJiBub2RlLnNjcm9sbEhlaWdodCA+IG5vZGUuY2xpZW50SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFNjcm9sbFBhcmVudChub2RlLnBhcmVudE5vZGUpIHx8IGRvY3VtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfb25Qb3BwZXJVcGRhdGUoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnBvcHBlck9uVXBkYXRlLmVtaXQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfc2V0Q29udGVudFByb3BlcnRpZXMocG9wcGVyUmVmOiBOZ3hQb3BwZXJqc0NvbnRlbnRDb21wb25lbnQpIHtcclxuICAgICAgICBwb3BwZXJSZWYucG9wcGVyT3B0aW9ucyA9IE5neFBvcHBlcmpzRGlyZWN0aXZlLmFzc2lnbkRlZmluZWQocG9wcGVyUmVmLnBvcHBlck9wdGlvbnMsIE5neFBvcHBlcmpzRGlyZWN0aXZlLmJhc2VPcHRpb25zLCB7XHJcbiAgICAgICAgICAgIHNob3dEZWxheTogdGhpcy5zaG93RGVsYXksXHJcbiAgICAgICAgICAgIGRpc2FibGVBbmltYXRpb246IHRoaXMuZGlzYWJsZUFuaW1hdGlvbixcclxuICAgICAgICAgICAgZGlzYWJsZURlZmF1bHRTdHlsaW5nOiB0aGlzLmRpc2FibGVTdHlsZSxcclxuICAgICAgICAgICAgcGxhY2VtZW50OiB0aGlzLnBsYWNlbWVudCxcclxuICAgICAgICAgICAgYm91bmRhcmllc0VsZW1lbnQ6IHRoaXMuYm91bmRhcmllc0VsZW1lbnQsXHJcbiAgICAgICAgICAgIHRyaWdnZXI6IHRoaXMuc2hvd1RyaWdnZXIsXHJcbiAgICAgICAgICAgIHBvc2l0aW9uRml4ZWQ6IHRoaXMucG9zaXRpb25GaXhlZCxcclxuICAgICAgICAgICAgcG9wcGVyTW9kaWZpZXJzOiB0aGlzLnBvcHBlck1vZGlmaWVycyxcclxuICAgICAgICAgICAgYXJpYURlc2NyaWJlOiB0aGlzLmFyaWFEZXNjcmliZSxcclxuICAgICAgICAgICAgYXJpYVJvbGU6IHRoaXMuYXJpYVJvbGUsXHJcbiAgICAgICAgICAgIGFwcGx5Q2xhc3M6IHRoaXMuYXBwbHlDbGFzcyxcclxuICAgICAgICAgICAgYXBwbHlBcnJvd0NsYXNzOiB0aGlzLnBvcHBlckFwcGx5QXJyb3dDbGFzcyxcclxuICAgICAgICAgICAgaGlkZU9uTW91c2VMZWF2ZTogdGhpcy5oaWRlT25Nb3VzZUxlYXZlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHRoaXMuc3R5bGVzLFxyXG4gICAgICAgICAgICBhcHBlbmRUbzogdGhpcy5wb3BwZXJBcHBlbmRUbyxcclxuICAgICAgICAgICAgcHJldmVudE92ZXJmbG93OiB0aGlzLnByZXZlbnRPdmVyZmxvdyxcclxuICAgICAgICB9KTtcclxuICAgICAgICBwb3BwZXJSZWYub25VcGRhdGUgPSB0aGlzLl9vblBvcHBlclVwZGF0ZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHBvcHBlclJlZi5vbkhpZGRlblxyXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHRoaXMuaGlkZS5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3NldERlZmF1bHRzKCkge1xyXG4gICAgICAgIFtcInNob3dEZWxheVwiLCBcImhpZGVPblNjcm9sbFwiLCBcImhpZGVPbk1vdXNlTGVhdmVcIiwgXCJoaWRlT25DbGlja091dHNpZGVcIiwgXCJhcmlhUm9sZVwiLCBcImFyaWFEZXNjcmliZVwiXS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgdGhpc1trZXldID0gdGhpc1trZXldID09PSB2b2lkIDAgPyBOZ3hQb3BwZXJqc0RpcmVjdGl2ZS5iYXNlT3B0aW9uc1trZXldIDogdGhpc1trZXldO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2hvd1RyaWdnZXIgPSB0aGlzLnNob3dUcmlnZ2VyIHx8IE5neFBvcHBlcmpzRGlyZWN0aXZlLmJhc2VPcHRpb25zLnRyaWdnZXI7XHJcbiAgICAgICAgdGhpcy5zdHlsZXMgPSB0aGlzLnN0eWxlcyA9PT0gdm9pZCAwID8gey4uLk5neFBvcHBlcmpzRGlyZWN0aXZlLmJhc2VPcHRpb25zLnN0eWxlc30gOiB0aGlzLnN0eWxlcztcclxuICAgIH1cclxuXHJcbn1cclxuIl19